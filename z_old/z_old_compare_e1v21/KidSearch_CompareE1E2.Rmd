---
title: "KidSearch Analyses:"
output:
  html_document:
    toc: true
    float: true
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo=TRUE, warning=FALSE, message=FALSE)
```

## GitHub Documents

Code to reproduce the analyses in manuscript, "Animacy and object size are reflected in preschoolers perceptual similarity computations by the preschool years"

## Step 1: Load packages

```{r}
library(tidyverse) # for data munging
library(knitr) # for kable table formating
library(haven) # import and e1ort 'SPSS', 'Stata' and 'SAS' Files
library(readxl) # import excel files
library(forcats) #manipulating factors in data frames
library(ez) # for anova
library(lme4)
library(markdown)


```

## Step 1: Load data and choose e1eriment
```{r} 
## Step 2: Load data
e1 = read_tsv("data/Animacy.txt")
e2 = read_tsv("data/ObjectSize.txt")

```

## Step 1: Preprocess data
```{r} 

##
e1$sub=e1$sub+100; 
e1$sub = as.factor(e1$sub)
e2$sub = as.factor(e2$sub)

e1$conditionNum = as.factor(e1$condition)
e2$conditionNum = as.factor(e2$condition)

# redundant but nice to have
e1$conditionName = as.factor(e1$conditionName)
e2$conditionName = as.factor(e2$conditionName)

e1$categoryNum = as.factor(e1$categoryNum)
e2$categoryNum = as.factor(e2$categoryNum)

e1$experiment = 'Animacy'
e2$experiment = 'Size'

## Step 3: Preprocess data
# count how many trials per subject
# Only get data with correct trials less than 4 seconds long when there were six items on the screen.
e1.tidy=e1 %>%
  filter(RT<4000) %>%
  filter(correct==1) %>%
  filter(phase=='SixItems') %>%
  filter(repeatDist==0) # for technical error trials in e1eriment 3 only.

e2.tidy=e2 %>%
  filter(RT<4000) %>%
  filter(correct==1) %>%
  filter(phase=='SixItems') %>%
  filter(repeatDist==0) # for technical error trials in e1eriment 3 only.
  
# Now only include subjects who had more than 1 trial speeded trial in each of 4 conditions
e1.tidy=e1.tidy %>%
  group_by(sub) %>%
  mutate(indivCountC1=sum(conditionNum==1 & categoryNum==1)) %>%
  mutate(indivCountC2=sum(conditionNum==1 & categoryNum==2)) %>%
  mutate(indivCountC3=sum(conditionNum==2 & categoryNum==1)) %>%
  mutate(indivCountC4=sum(conditionNum==2 & categoryNum==2)) %>%
  filter(indivCountC1>1) %>%
  filter(indivCountC2>1) %>%
  filter(indivCountC3>1) %>%
  filter(indivCountC4>1) 

e2.tidy=e2.tidy %>%
  group_by(sub) %>%
  mutate(indivCountC1=sum(conditionNum==1 & categoryNum==1)) %>%
  mutate(indivCountC2=sum(conditionNum==1 & categoryNum==2)) %>%
  mutate(indivCountC3=sum(conditionNum==2 & categoryNum==1)) %>%
  mutate(indivCountC4=sum(conditionNum==2 & categoryNum==2)) %>%
  filter(indivCountC1>1) %>%
  filter(indivCountC2>1) %>%
  filter(indivCountC3>1) %>%
  filter(indivCountC4>1) 

# Store included subs
includedSubsE1=unique(e1.tidy$sub)
includedSubsE2=unique(e2.tidy$sub)

```

## Step 2: RT results comparison
```{r} 

bothExp=rbind(e1.tidy, e2.tidy)
bothExp$experiment=as.factor(bothExp$experiment)
bothExp$sub=as.factor(bothExp$sub)

## Compare E1 v E2
E1vE2=ezANOVA(dv= .(RT), wid= .(sub), within= .(conditionName), between =.(experiment), detailed=TRUE, data=data.frame(bothExp, type=3))
partialEtaSquared=E1vE2$ANOVA$SSn/(E1vE2$ANOVA$SSn + E1vE2$ANOVA$SSd)

## Cohens DZ calculation
Animacy=e1.tidy %>%
  group_by(conditionName,sub) %>%
  summarise(meanRT= mean(RT))

AnimacyBySub=Animacy$meanRT[Animacy$conditionName=='uniform']-Animacy$meanRT[Animacy$conditionName=='mixed']


Size=e2.tidy %>%
  group_by(conditionName,sub) %>%
  summarise(meanRT= mean(RT))

SizeBySub=Size$meanRT[Size$conditionName=='uniform']-Size$meanRT[Size$conditionName=='mixed']


```

Effect of experiment on RT: (*F*(1,`r E1vE2$ANOVA$DFd[2]`)= `r round(E1vE2$ANOVA$F[2],2)`, *p* = `r round(E1vE2$ANOVA$p[2],2)`, *partial eta squared*= `r round(partialEtaSquared[2],2)`

Effect of condition on RT:  (*F*(1,`r E1vE2$ANOVA$DFd[2]`) = `r round(E1vE2$ANOVA$F[3],2)`, *p* = `r round(E1vE2$ANOVA$p[3],2)`, *partial eta squared*= `r round(partialEtaSquared[3],2)`

Effect of their interaction on RT:  (*F*(1,`r E1vE2$ANOVA$DFd[2]`) = `r round(E1vE2$ANOVA$F[4],2)`, *p* = `r round(E1vE2$ANOVA$p[4],2)`, *partial eta squared*= `r round(partialEtaSquared[4],2)`










